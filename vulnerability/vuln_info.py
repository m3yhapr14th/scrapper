import requests
from bs4 import BeautifulSoup
import json, os
import page_file

n = 0
vuln_list = []
while n < int(page_file.page_replace):
    n+=1
    req_all = requests.get('https://www.krcert.or.kr/kr/bbs/list.do?bbsId=B0000302&menuNo=205023&pageIndex={0}&searchCnd=1' .format(n))

    scrap_all = BeautifulSoup(req_all.content, 'html.parser')
    table_find = scrap_all.find('table').find('tbody')
    trs = table_find.find_all('tr')

    for tr in trs:
        tds = tr.find_all('td')
        num = tds[0].text
        title = tds[1].text
        rep_title = title.replace("\t", "").replace("\n", "").replace("\r", "")
        severity = tds[2].text
        cvss = tds[3].text
        vuln_dic = {'num':num, 'title':rep_title, 'severity':severity, 'cvss':cvss}
        vuln_list.append(vuln_dic)

file_path = os.path.dirname(os.path.realpath(__file__)) # 현재 폴더 확인(본 파일의 실행 경로)
os.chdir(file_path) # 본 파일이 실행되는 경로로 이동
with open('vuln.json', 'w', encoding="utf-8") as make_file:
    json.dump(vuln_list, make_file, ensure_ascii=False, indent="\t")